# Proposal: 回合制与棋将血量、怪物 AI

## Why

当前对战仅有棋将操作与敌将展示，缺少回合交替与战斗结算，无法形成完整的“我方行动 → 怪物行动”循环；棋将没有血量无法被击杀，怪物缺乏行为逻辑。本变更引入回合制、每回合两次行为、棋将血量（配置驱动）以及怪物寻最近单位攻击/移动的 AI，以规范化推进对战流程与数值体验。

## What Changes

- **回合系统**：我方与怪物方轮流进行回合；每回合拥有两次行为，每次行为可为一次移动或一次攻击（组合方式：一次移动+一次攻击、两次移动、或两次攻击）。
- **棋将血量**：为棋将添加血量（HP）；血量初始值从 `config/General.xlsx` 的 **血量（GHp）** 列读取，与现有 ID/攻击力/攻击距离/移动距离/形象配置 并列。
- **怪物 AI**：怪物方回合内，每个怪物按“寻找最近的可交互单位”决策；若当前可攻击到该单位则立即攻击（伤害为 1），否则执行移动向目标靠近；每只怪物在本方回合内同样遵循“两次行为”的规则。
- **配置与数据**：扩展 `HeroConfig` 与 General.xlsx 表头以支持 GHp；现有 `ApplyToHero` 等 API 需支持应用血量初始值。

## Capabilities

### New Capabilities

- `turn-system`: 回合状态（我方/怪物方）、回合内行为次数（2 次）、行为类型（移动/攻击）的规则与流程控制。
- `monster-ai`: 怪物在己方回合内的决策逻辑——选择最近单位、可攻击则攻击（伤害 1）、不可攻击则移动，以及两次行为的消耗与顺序。
- `hero-hp`: 棋将血量属性、初始值从 General.xlsx 的 GHp 列读取、在战斗中的增减与显示（含与怪物攻击伤害 1 的结算）。

### Modified Capabilities

- （无现有 OpenSpec 规格需修改；实现上将扩展现有 `GeneralConfigLoader` / `HeroConfig` / 棋将场景的配置与展示，属实现层面扩展。）

## Impact

- **配置**：`config/General.xlsx` 新增列「血量」或「GHp」；需在文档（如 OPENSPEC.md）中说明表头与含义。
- **代码**：`HeroConfig` 增加 GHp 字段；`GeneralConfigLoader` 解析并暴露；`ChessHero`（及可选 UI）支持当前血量与初始血量；`FightBoard` 或等价战场控制器负责回合切换、行为计数与怪物 AI 调度；`ChessEnemy` 需参与“最近单位”计算与攻击/移动执行。
- **依赖**：无新增外部依赖；沿用现有 Excel 与 Godot 节点体系。
